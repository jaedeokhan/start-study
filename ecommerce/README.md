# E-Commerce ν”„λ΅μ νΈ

## π“‹ λ©μ°¨
1. [ν”„λ΅μ νΈ κ°μ”](#ν”„λ΅μ νΈ-κ°μ”)
2. [κΈ°λ¥ λ©λ΅](#κΈ°λ¥-λ©λ΅)
3. [ν¨ν‚¤μ§€ κµ¬μ„±](#ν¨ν‚¤μ§€-κµ¬μ„±)
4. [λ™μ‹μ„± μ μ–΄ λ°©μ‹](#λ™μ‹μ„±-μ μ–΄-λ°©μ‹)
5. [ν…μ¤νΈ](#ν…μ¤νΈ)

---

## ν”„λ΅μ νΈ κ°μ”

### κΈ°μ  μ¤νƒ
- **Language**: Java 17
- **Framework**: Spring Boot 3.x
- **Build Tool**: Gradle
- **Test**: JUnit 5, AssertJ
- **Storage**: In-Memory (ConcurrentHashMap)
- **Documentation**: SpringDoc OpenAPI (Swagger)

### μ•„ν‚¤ν…μ²
- **λ μ΄μ–΄λ“ μ•„ν‚¤ν…μ²**: Presentation - Application - Domain - Infrastructure
- **λ™μ‹μ„± μ μ–΄**: ReentrantLock κΈ°λ°

---

## κΈ°λ¥ λ©λ΅

### 1. μƒν’ (Product)
- μƒν’ λ©λ΅ μ΅°ν (νμ΄μ§•)
- μƒν’ μƒμ„Έ μ΅°ν
- μΈκΈ° μƒν’ μ΅°ν (μ΅°νμ κΈ°λ°)
- μ¬κ³  κ΄€λ¦¬ (λ™μ‹μ„± μ μ–΄)

### 2. μ¥λ°”κµ¬λ‹ (Cart)
- μ¥λ°”κµ¬λ‹ μ΅°ν
- μ¥λ°”κµ¬λ‹ μƒν’ μ¶”κ°€
- μ¥λ°”κµ¬λ‹ μƒν’ μλ‰ λ³€κ²½
- μ¥λ°”κµ¬λ‹ μƒν’ μ‚­μ 

### 3. μΏ ν° (Coupon)
- μΏ ν° μ΄λ²¤νΈ λ©λ΅ μ΅°ν
- μ„ μ°©μ μΏ ν° λ°κΈ‰ (λ™μ‹μ„± μ μ–΄)
- μ‚¬μ©μ μΏ ν° λ©λ΅ μ΅°ν

### 4. μ£Όλ¬Έ (Order)
- μ£Όλ¬Έ μƒμ„± (μ¬κ³  μ°¨κ°, ν¬μΈνΈ μ‚¬μ©, μΏ ν° μ μ©)
- μ£Όλ¬Έ λ©λ΅ μ΅°ν
- μ£Όλ¬Έ μƒμ„Έ μ΅°ν

### 5. ν¬μΈνΈ (Point)
- ν¬μΈνΈ μ”μ•΅ μ΅°ν
- ν¬μΈνΈ μ¶©μ „ (λ™μ‹μ„± μ μ–΄)
- ν¬μΈνΈ μ‚¬μ© μ΄λ ¥ μ΅°ν

---

## ν¨ν‚¤μ§€ κµ¬μ„±

### μ „μ²΄ κµ¬μ΅°
```
com.ecommerce
β”β”€β”€ presentation          # ν‘ν„ κ³„μΈµ
β”β”€β”€ application          # μ‘μ© κ³„μΈµ
β”‚   β””β”€β”€ usecase          # μ μ¤μΌ€μ΄μ¤ (λ„λ©”μΈλ³„ ν¨ν‚¤μ§€)
β”β”€β”€ domain               # λ„λ©”μΈ κ³„μΈµ
β”β”€β”€ infrastructure       # μΈν”„λΌ κ³„μΈµ
β””β”€β”€ config               # μ„¤μ •
```

---

## λ™μ‹μ„± μ μ–΄ λ°©μ‹

### μ„ νƒν• λ°©μ‹: ReentrantLock

#### μ„ νƒ μ΄μ 
λ³Έ ν”„λ΅μ νΈλ” **In-Memory μ €μ¥μ†**λ¥Ό μ‚¬μ©ν•λ” λ‹¨μΌ JVM ν™κ²½μΌλ΅, **ReentrantLock**μ„ ν†µν•΄ λ™μ‹μ„±μ„ μ μ–΄ν•©λ‹λ‹¤.

#### μ¥μ 
| ν•­λ© | μ„¤λ… |
|------|------|
| **λ…μ‹μ  μ μ–΄** | Lock/Unlockμ„ λ…μ‹μ μΌλ΅ μ μ–΄ν•μ—¬ μ½”λ“ μλ„κ°€ λ…ν™• |
| **μ¬μ§„μ… κ°€λ¥** | κ°™μ€ μ¤λ λ“κ°€ μ΄λ―Έ νλ“ν• Lockμ„ λ‹¤μ‹ νλ“ κ°€λ¥ |
| **κ³µμ •μ„± μµμ…** | Fair Lock μ‚¬μ© μ‹ λ€κΈ° μμ„λ€λ΅ Lock νλ“ κ°€λ¥ |
| **νƒ€μ„μ•„μ›ƒ μ§€μ›** | `tryLock(timeout)`μΌλ΅ λ¬΄ν• λ€κΈ° λ°©μ§€ κ°€λ¥ |
| **μ„Έλ°€ν• μ μ–΄** | Condition λ³€μλ¥Ό ν†µν• λ³µμ΅ν• λ™κΈ°ν™” μ‹λ‚λ¦¬μ¤ κµ¬ν„ |
| **μ¶”κ°€ μΈν”„λΌ λ¶ν•„μ”** | λ‹¨μΌ JVM ν™κ²½μ—μ„ λ³„λ„ μΈν”„λΌ μ—†μ΄ μ‚¬μ© κ°€λ¥ |

#### λ‹¨μ  λ° λ€μ‘ λ°©μ•
| ν•­λ© | μ„¤λ… | λ€μ‘ λ°©μ• |
|------|------|----------|
| **μ½”λ“ λ³µμ΅λ„** | finally λΈ”λ΅μ—μ„ λ°λ“μ‹ unlock ν•„μ” | ν…ν”λ¦Ώ λ©”μ„λ“ ν¨ν„΄ μ μ© κ³ λ ¤ |
| **λ¶„μ‚° ν™κ²½ λ―Έμ§€μ›** | λ‹¨μΌ JVM λ‚΄μ—μ„λ§ λ™μ‘ | λ¶„μ‚° ν™κ²½ μ „ν™ μ‹ Redis LockμΌλ΅ κµμ²΄ |
| **λ°λ“λ½ μ„ν—** | μλ»λ μ‚¬μ© μ‹ λ°λ“λ½ λ°μƒ κ°€λ¥ | Lock νλ“ μμ„ μ •μ λ° ν…μ¤νΈ κ°•ν™” |

### κµ¬ν„ μ„μΉ: Repository κ³„μΈµ

```
Controller/API
    β†“
UseCase (λΉ„μ¦λ‹μ¤ λ΅μ§)
    β†“
Repository (λ™μ‹μ„± μ μ–΄ + λ°μ΄ν„° μ ‘κ·Ό) β† ReentrantLock μ μ©
    β†“
Entity (λ„λ©”μΈ λ΅μ§ + κ²€μ¦)
    β†“
In-Memory Store (ConcurrentHashMap)
```

#### Repository κ³„μΈµμ„ μ„ νƒν• μ΄μ 
| μ΄μ  | μ„¤λ… |
|------|------|
| **κ΄€μ‹¬μ‚¬ λ¶„λ¦¬** | UseCaseλ” λΉ„μ¦λ‹μ¤ λ΅μ§μ—λ§ μ§‘μ¤‘, λ™μ‹μ„± μ μ–΄λ” Repositoryκ°€ λ‹΄λ‹Ή |
| **μ¬μ‚¬μ©μ„±** | μ—¬λ¬ UseCaseμ—μ„ λ™μΌν• Repository λ©”μ„λ“λ¥Ό μ•μ „ν•κ² κ³µμ  |
| **ν…μ¤νΈ μ©μ΄μ„±** | κ³„μΈµλ³„ λ…λ¦½μ μΈ λ‹¨μ„ ν…μ¤νΈ μ‘μ„± κ°€λ¥ |
| **λ³€κ²½ μ©μ΄μ„±** | DB μ „ν™ μ‹ Repository κµ¬ν„μ²΄λ§ κµμ²΄ν•λ©΄ λ¨ |

### μ μ© μμ—­

#### 1. μƒν’ μ¬κ³  μ°¨κ°
**λ¬Έμ **: μ—¬λ¬ μ‚¬μ©μκ°€ λ™μ‹μ— κ°™μ€ μƒν’μ„ μ£Όλ¬Έν•λ©΄ μ¬κ³ κ°€ μμκ°€ λ  μ μμ

**ν•΄κ²°**: μƒν’λ³„ λ…λ¦½μ μΈ LockμΌλ΅ μ¬κ³  μ΅°ν λ° μ°¨κ°μ„ μ›μμ μΌλ΅ μν–‰
- μ„μΉ: `InMemoryProductRepository.decreaseStock()`
- Lock λ‹¨μ„: `productId`
- ν¨κ³Ό: μ„λ΅ λ‹¤λ¥Έ μƒν’μ€ λ™μ‹ μ²λ¦¬, κ°™μ€ μƒν’μ€ μμ°¨ μ²λ¦¬

#### 2. μ„ μ°©μ μΏ ν° λ°κΈ‰
**λ¬Έμ **: 100κ° ν•μ • μΏ ν°μ— λ™μ‹ μ”μ²­ μ‹ 100κ° μ΄μƒ λ°κΈ‰λ  μ μμ

**ν•΄κ²°**: μΏ ν° μ΄λ²¤νΈλ³„ LockμΌλ΅ λ°κΈ‰ μλ‰ μ²΄ν¬ λ° μ¦κ°€λ¥Ό μ›μμ μΌλ΅ μν–‰
- μ„μΉ: `InMemoryCouponEventRepository.issueCoupon()`
- Lock λ‹¨μ„: `couponEventId`
- ν¨κ³Ό: μ •ν™•ν• μ„ μ°©μ μλ‰ μ ν• λ³΄μ¥

#### 3. ν¬μΈνΈ μ¶©μ „/μ‚¬μ©
**λ¬Έμ **: λ™μΌ μ‚¬μ©μμ λ™μ‹ μ¶©μ „/μ‚¬μ© μ”μ²­ μ‹ μ”μ•΅μ΄ λ¶€μ •ν™•ν•΄μ§ μ μμ

**ν•΄κ²°**: μ‚¬μ©μλ³„ LockμΌλ΅ ν¬μΈνΈ μ΅°ν λ° λ³€κ²½μ„ μ›μμ μΌλ΅ μν–‰
- μ„μΉ: `InMemoryUserRepository.chargePoint()`, `usePoint()`
- Lock λ‹¨μ„: `userId`
- ν¨κ³Ό: ν¬μΈνΈ μ”μ•΅ λ° μ΄λ ¥ μ •ν•©μ„± λ³΄μ¥

### λ€μ• λ°©μ‹ λΉ„κµ

#### λΉ„κµν‘
| λ°©μ‹ | νƒ€μ„μ•„μ›ƒ | κ³µμ •μ„± | μ„±λ¥ | λ¶„μ‚° μ§€μ› | In-Memory | λ³µμ΅λ„ |
|------|---------|--------|------|----------|-----------|--------|
| **ReentrantLock** | β… | β… | β­β­β­β­ | β | β… | μ¤‘κ°„ |
| **synchronized** | β | β | β­β­β­β­β­ | β | β… | λ‚®μ |
| **Optimistic Lock** | β… | N/A | β­β­β­β­β­ | β… | β | λ†’μ |
| **Pessimistic Lock** | β… | β… | β­β­ | β… | β | μ¤‘κ°„ |
| **Redis Lock** | β… | β… | β­β­β­ | β… | β… | λ†’μ |

#### 1. synchronized
- **μ¥μ **: κ°„κ²°ν• λ¬Έλ²•, μλ™ Lock ν•΄μ , JVM μµμ ν™”
- **λ‹¨μ **: νƒ€μ„μ•„μ›ƒ/κ³µμ •μ„±/μΈν„°λ½νΈ λ¶κ°€λ¥
- **μ μ© μ‹λ‚λ¦¬μ¤**: λ‹¨μν• λ™κΈ°ν™”, μ½”λ“ λ³µμ΅λ„ μµμ†ν™”

#### 2. Optimistic Lock (λ‚™κ΄€μ  μ κΈ)
- **μ¥μ **: Lock μ—†μ΄ λ†’μ€ μ„±λ¥, λ°λ“λ½ μ—†μ, μ½κΈ° λ§μ€ ν™κ²½ μ ν•©
- **λ‹¨μ **: μ¶©λ μ‹ μ¬μ‹λ„ ν•„μ”, μ“°κΈ° λ§μΌλ©΄ μ„±λ¥ μ €ν•, DB ν•„μ”
- **μ μ© μ‹λ‚λ¦¬μ¤**: μ½κΈ° >> μ“°κΈ°, DB μ‚¬μ©, μ¶©λ κ°€λ¥μ„± λ‚®μ

#### 3. Pessimistic Lock (λΉ„κ΄€μ  μ κΈ)
- **μ¥μ **: λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥, μ¬μ‹λ„ λ¶ν•„μ”, μ“°κΈ° λ§μ€ ν™κ²½ μ ν•©
- **λ‹¨μ **: Lock λ€κΈ°λ΅ μ„±λ¥ μ €ν•, λ°λ“λ½ κ°€λ¥μ„±, DB ν•„μ”
- **μ μ© μ‹λ‚λ¦¬μ¤**: μ“°κΈ° λ§μ, μ¶©λ κ°€λ¥μ„± λ†’μ, μΌκ΄€μ„± μµμ°μ„ 

#### 4. Redis Distributed Lock
- **μ¥μ **: λ¶„μ‚° ν™κ²½ μ§€μ›, νƒ€μ„μ•„μ›ƒ μ§€μ›, μ¤μΌ€μΌ μ•„μ›ƒ κ°€λ¥
- **λ‹¨μ **: μ™Έλ¶€ μΈν”„λΌ ν•„μ”, λ„¤νΈμ›ν¬ μ§€μ—°, κµ¬ν„ λ³µμ΅λ„ μ¦κ°€
- **μ μ© μ‹λ‚λ¦¬μ¤**: λ©€ν‹° μ„λ²„, λ§μ΄ν¬λ΅μ„λΉ„μ¤, λ†’μ€ κ°€μ©μ„± ν•„μ”