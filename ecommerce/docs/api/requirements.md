# 이커머스 서비스 요구사항 명세서

## 1. 프로젝트 개요

### 1.1 학습 목표
- 상품 카탈로그와 재고 관리 시스템 설계
- 주문/결제 프로세스 모델링
- 선착순 쿠폰 시스템 설계
- 외부 데이터 플랫폼 연동을 고려한 설계

---

## 2. 기능적 요구사항 (Functional Requirements)

### 2.1 상품 관리

#### 2.1.1 상품 정보 조회
- **FR-PROD-001**: 시스템은 상품의 기본 정보(상품명, 설명, 가격 정보 등)를 조회할 수 있어야 한다.
- **FR-PROD-002**: 시스템은 상품의 현재 재고 수량을 실시간으로 조회할 수 있어야 한다.
- **FR-PROD-003**: 시스템은 여러 상품 목록을 조회할 수 있어야 한다.

#### 2.1.2 재고 관리
- **FR-INVT-001**: 시스템은 주문 시 재고를 실시간으로 확인할 수 있어야 한다.
- **FR-INVT-002**: 시스템은 주문 완료 시 해당 상품의 재고를 차감할 수 있어야 한다.
- **FR-INVT-003**: 시스템은 재고가 부족한 경우 주문을 거부해야 한다.
- **FR-INVT-004**: 시스템은 동시에 여러 주문이 발생할 때 재고 차감의 정합성을 보장해야 한다.

#### 2.1.3 인기 상품 통계
- **FR-STAT-001**: 시스템은 최근 3일간의 주문 데이터를 기반으로 인기 상품을 집계해야 한다.
- **FR-STAT-002**: 시스템은 판매량 기준으로 상위 5개의 인기 상품을 제공해야 한다.
- **FR-STAT-003**: 시스템은 인기 상품 목록을 조회할 수 있는 API를 제공해야 한다.

### 2.2 주문/결제 시스템

#### 2.2.1 장바구니 기능
- **FR-CART-001**: 사용자는 상품을 장바구니에 추가할 수 있어야 한다.
- **FR-CART-002**: 사용자는 장바구니에 담긴 상품 목록을 조회할 수 있어야 한다.
- **FR-CART-003**: 사용자는 장바구니에서 상품을 제거할 수 있어야 한다.
- **FR-CART-004**: 사용자는 장바구니에 담긴 상품의 수량을 변경할 수 있어야 한다.
- **FR-CART-005**: 시스템은 장바구니에 담긴 상품의 총 금액을 계산할 수 있어야 한다.

#### 2.2.2 주문 처리
- **FR-ORDR-001**: 사용자는 장바구니의 상품으로 주문을 생성할 수 있어야 한다.
- **FR-ORDR-002**: 시스템은 주문 생성 시 각 상품의 재고를 확인해야 한다.
- **FR-ORDR-003**: 시스템은 재고가 충분한 경우에만 주문을 진행해야 한다.
- **FR-ORDR-004**: 시스템은 주문 완료 후 재고를 차감해야 한다.
- **FR-ORDR-005**: 사용자는 본인의 주문 내역을 조회할 수 있어야 한다.
- **FR-ORDR-006**: 시스템은 주문 상태(대기, 완료, 취소 등)를 관리해야 한다.

#### 2.2.3 포인트 처리
- **FR-PAY-001**: 시스템은 사용자의 포인트 정보를 관리해야 한다.
- **FR-PAY-002**: 사용자는 본인의 포인트를 조회할 수 있어야 한다.
- **FR-PAY-003**: 사용자는 포인트를 충전할 수 있어야 한다.
- **FR-PAY-004**: 시스템은 주문 금액과 사용자 포인트를 비교하여 결제 가능 여부를 확인해야 한다.
- **FR-PAY-005**: 시스템은 결제 시 쿠폰 할인을 적용할 수 있어야 한다.
- **FR-PAY-006**: 시스템은 결제 완료 시 사용자 포인트를 차감해야 한다.
- **FR-PAY-007**: 시스템은 포인트가 부족한 경우 결제를 거부해야 한다.
- **FR-PAY-008**: 시스템은 포인트 충전/사용/환불 이력을 기록해야 한다.

### 2.3 쿠폰 시스템

#### 2.3.1 쿠폰 발급
- **FR-COUP-001**: 시스템은 선착순으로 제한된 수량의 쿠폰을 발급할 수 있어야 한다.
- **FR-COUP-002**: 시스템은 쿠폰 발급 시 남은 수량을 확인해야 한다.
- **FR-COUP-003**: 시스템은 쿠폰이 소진된 경우 발급을 거부해야 한다.
- **FR-COUP-004**: 사용자는 본인이 보유한 쿠폰 목록을 조회할 수 있어야 한다.
- **FR-COUP-005**: 시스템은 동시에 여러 발급 요청이 발생할 때 쿠폰 수량의 정합성을 보장해야 한다.

#### 2.3.2 쿠폰 사용
- **FR-COUP-006**: 시스템은 결제 시 쿠폰의 유효성을 검증해야 한다.
- **FR-COUP-007**: 시스템은 쿠폰의 유효기간을 확인해야 한다.
- **FR-COUP-008**: 시스템은 이미 사용된 쿠폰의 재사용을 방지해야 한다.
- **FR-COUP-009**: 시스템은 쿠폰 사용 이력을 기록해야 한다.
- **FR-COUP-010**: 시스템은 쿠폰 할인율 또는 할인 금액을 적용하여 최종 결제 금액을 계산해야 한다.

### 2.4 데이터 연동

#### 2.4.1 외부 데이터 플랫폼 연동
- **FR-DATA-001**: 시스템은 주문 완료 시 주문 데이터를 외부 데이터 플랫폼으로 전송해야 한다.
- **FR-DATA-002**: 시스템은 외부 플랫폼 연동 실패 시에도 주문을 정상적으로 처리해야 한다.
- **FR-DATA-003**: 시스템은 데이터 전송 실패 이력을 기록해야 한다.
- **FR-DATA-004**: 시스템은 실패한 데이터 전송을 재시도할 수 있어야 한다.

---

## 3. 비기능적 요구사항 (Non-Functional Requirements)

### 3.1 성능 (Performance)

#### 3.1.1 응답 시간
- **NFR-PERF-001**: 상품 조회 API는 평균 200ms 이내에 응답해야 한다.
- **NFR-PERF-002**: 주문 처리는 3초 이내에 완료되어야 한다.
- **NFR-PERF-003**: 인기 상품 조회는 500ms 이내에 응답해야 한다.

#### 3.1.2 처리량
- **NFR-PERF-004**: 시스템은 동시에 최소 100개의 주문 요청을 처리할 수 있어야 한다.
- **NFR-PERF-005**: 시스템은 초당 최소 1000개의 상품 조회 요청을 처리할 수 있어야 한다.

### 3.2 데이터 정합성 (Data Integrity)

#### 3.2.1 동시성 제어
- **NFR-INTG-001**: 시스템은 동시에 같은 상품에 대한 여러 주문이 발생해도 재고 수량의 정합성을 보장해야 한다.
- **NFR-INTG-002**: 시스템은 동시에 쿠폰 발급 요청이 발생해도 발급 수량의 정합성을 보장해야 한다.
- **NFR-INTG-003**: 시스템은 동시에 포인트 차감이 발생해도 사용자 포인트의 정합성을 보장해야 한다.

#### 3.2.2 트랜잭션 관리
- **NFR-INTG-004**: 주문-결제-재고차감은 원자적으로 처리되어야 한다 (All or Nothing).
- **NFR-INTG-005**: 시스템 오류 발생 시 데이터 일관성이 유지되어야 한다.

### 3.3 가용성 (Availability)

- **NFR-AVAIL-001**: 외부 데이터 플랫폼 장애 시에도 주문/결제 기능은 정상 동작해야 한다.
- **NFR-AVAIL-002**: 시스템은 99% 이상의 가용성을 유지해야 한다.

### 3.4 확장성 (Scalability)

- **NFR-SCAL-001**: 시스템은 상품 수가 증가해도 조회 성능이 유지되어야 한다.
- **NFR-SCAL-002**: 시스템은 사용자 수가 증가해도 주문 처리 성능이 유지되어야 한다.

### 3.5 보안 (Security)

- **NFR-SEC-001**: 시스템은 사용자의 포인트 정보를 안전하게 관리해야 한다.
- **NFR-SEC-002**: 시스템은 쿠폰 중복 발급을 방지해야 한다.
- **NFR-SEC-003**: 시스템은 주문 데이터의 무결성을 보장해야 한다.

### 3.6 유지보수성 (Maintainability)

- **NFR-MAINT-001**: 코드는 레이어드 아키텍처를 따라 명확하게 분리되어야 한다.
- **NFR-MAINT-002**: 각 도메인은 독립적으로 수정 가능해야 한다.
- **NFR-MAINT-003**: 외부 연동 로직은 비즈니스 로직과 분리되어야 한다.

### 3.7 테스트 가능성 (Testability)

- **NFR-TEST-001**: 각 비즈니스 로직은 단위 테스트가 가능해야 한다.
- **NFR-TEST-002**: 동시성 제어 로직은 통합 테스트로 검증 가능해야 한다.
- **NFR-TEST-003**: 외부 연동 로직은 Mock을 통해 테스트 가능해야 한다.

### 3.8 모니터링 (Monitoring)

- **NFR-MONI-001**: 시스템은 주요 API의 응답 시간을 측정할 수 있어야 한다.
- **NFR-MONI-002**: 시스템은 외부 데이터 플랫폼 연동 실패를 추적할 수 있어야 한다.
- **NFR-MONI-003**: 시스템은 재고 부족, 쿠폰 소진 등의 이벤트를 로깅해야 한다.

---

## 4. 핵심 비즈니스 규칙

### 4.1 재고 관리
- 재고는 주문 완료 시점에 차감된다
- 재고가 0 이하가 될 수 없다
- 동시 주문 시 먼저 처리되는 주문이 우선권을 가진다

### 4.2 쿠폰 시스템
- 쿠폰은 선착순으로 발급되며, 발급 수량이 소진되면 더 이상 발급할 수 없다
- 쿠폰은 한 번만 사용 가능하다
- 유효기간이 지난 쿠폰은 사용할 수 없다
- 한 주문에 하나의 쿠폰만 적용 가능하다

### 4.3 포인트 결제 처리
- 결제는 포인트 기반으로 처리된다
- 쿠폰 할인이 먼저 적용된 후 포인트에서 차감한다
- 포인트가 부족하면 결제가 실패한다
- 결제 실패 시 재고는 차감되지 않는다
- 모든 포인트 변동은 point_histories 테이블에 기록된다

### 4.4 데이터 연동
- 외부 데이터 플랫폼 전송은 비동기로 처리된다
- 전송 실패는 주문 처리에 영향을 주지 않는다
- 실패한 전송은 별도로 관리되어 재시도 가능해야 한다

---

## 5. 우선순위

### 높음 (High)
- 상품 조회 기능 (FR-PROD-001~003)
- 재고 관리 및 정합성 (FR-INVT-001~004, NFR-INTG-001)
- 주문/결제 처리 (FR-ORDR-001~006, FR-PAY-001~007)
- 트랜잭션 관리 (NFR-INTG-004~005)

### 중간 (Medium)
- 장바구니 기능 (FR-CART-001~005)
- 쿠폰 발급 및 사용 (FR-COUP-001~010)
- 인기 상품 통계 (FR-STAT-001~003)
- 동시성 제어 (NFR-INTG-002~003)

### 낮음 (Low)
- 외부 데이터 플랫폼 연동 (FR-DATA-001~004)
- 모니터링 및 로깅 (NFR-MONI-001~003)
