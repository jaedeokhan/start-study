# 이커머스 서비스 사용자 스토리

## 목차
1. [상품 관리](#1-상품-관리)
2. [장바구니](#2-장바구니)
3. [주문 처리](#3-주문-처리)
4. [결제 시스템](#4-결제-시스템)
5. [쿠폰 시스템](#5-쿠폰-시스템)
6. [데이터 연동](#6-데이터-연동)

---

## 1. 상품 관리

### US-PROD-001: 상품 목록 조회
**As a** 고객
**I want** 판매 중인 상품 목록을 조회하고 싶다
**So that** 구매하고 싶은 상품을 찾을 수 있다

**Acceptance Criteria:**
- [ ] 상품 목록 조회 API를 호출하면 모든 상품 정보를 반환한다
- [ ] 각 상품은 ID, 상품명, 가격, 재고 수량을 포함한다
- [ ] 응답 시간은 평균 200ms 이내여야 한다
- [ ] 재고가 0인 상품도 목록에 표시된다
- [ ] 페이지네이션을 지원한다 (optional)

**Related Requirements:** FR-PROD-001, FR-PROD-002, FR-PROD-003, FR-PROD-004, NFR-PERF-001

---

### US-PROD-002: 상품 상세 정보 조회
**As a** 고객
**I want** 특정 상품의 상세 정보를 조회하고 싶다
**So that** 구매 결정을 내리기 전에 상품에 대한 충분한 정보를 얻을 수 있다

**Acceptance Criteria:**
- [ ] 상품 ID를 통해 상품 상세 정보를 조회할 수 있다
- [ ] 상품명, 설명, 가격, 현재 재고 수량이 반환된다
- [ ] 존재하지 않는 상품 ID로 조회 시 404 에러를 반환한다
- [ ] 재고 정보는 실시간으로 반영된다
- [ ] 응답 시간은 평균 200ms 이내여야 한다

**Related Requirements:** FR-PROD-005, FR-PROD-003, NFR-PERF-001

---

### US-PROD-003: 인기 상품 조회
**As a** 고객
**I want** 최근 인기 있는 상품을 조회하고 싶다
**So that** 많은 사람들이 구매하는 트렌드 상품을 쉽게 찾을 수 있다

**Acceptance Criteria:**
- [ ] 최근 3일간의 판매 데이터를 기반으로 인기 상품을 조회할 수 있다
- [ ] 판매량 기준 상위 5개 상품이 반환된다
- [ ] 각 상품의 판매 수량이 함께 표시된다
- [ ] 응답 시간은 평균 500ms 이내여야 한다
- [ ] 판매 이력이 없는 경우 빈 목록을 반환한다

**Related Requirements:** FR-STAT-001, FR-STAT-002, FR-STAT-003, NFR-PERF-003

---

## 2. 장바구니

### US-CART-001: 장바구니에 상품 추가
**As a** 고객
**I want** 관심 있는 상품을 장바구니에 담고 싶다
**So that** 나중에 한 번에 주문할 수 있다

**Acceptance Criteria:**
- [ ] 상품 ID와 수량을 입력하여 장바구니에 추가할 수 있다
- [ ] 이미 장바구니에 있는 상품을 추가하면 수량이 증가한다
- [ ] 재고보다 많은 수량을 담으려 할 때 경고 메시지를 반환한다
- [ ] 존재하지 않는 상품 ID는 추가할 수 없다
- [ ] 수량은 1 이상이어야 한다

**Related Requirements:** FR-CART-001

---

### US-CART-002: 장바구니 조회
**As a** 고객
**I want** 내 장바구니에 담긴 상품을 확인하고 싶다
**So that** 주문 전에 구매 목록과 총 금액을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에 담긴 모든 상품 목록을 조회할 수 있다
- [ ] 각 상품의 이름, 가격, 수량, 소계가 표시된다
- [ ] 전체 상품의 총 금액이 계산되어 표시된다
- [ ] 장바구니가 비어있는 경우 빈 목록과 총액 0을 반환한다
- [ ] 상품의 현재 재고 상태가 반영된다

**Related Requirements:** FR-CART-002, FR-CART-005

---

### US-CART-003: 장바구니 상품 수량 변경
**As a** 고객
**I want** 장바구니에 담긴 상품의 수량을 변경하고 싶다
**So that** 주문 전에 구매 수량을 조정할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에 있는 상품의 수량을 변경할 수 있다
- [ ] 수량은 1 이상이어야 한다
- [ ] 재고보다 많은 수량으로 변경할 수 없다
- [ ] 수량 변경 후 총 금액이 자동으로 재계산된다
- [ ] 존재하지 않는 장바구니 항목은 변경할 수 없다

**Related Requirements:** FR-CART-004, FR-CART-005

---

### US-CART-004: 장바구니 상품 제거
**As a** 고객
**I want** 장바구니에서 상품을 제거하고 싶다
**So that** 구매하지 않을 상품을 장바구니에서 삭제할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에 있는 특정 상품을 제거할 수 있다
- [ ] 제거 후 총 금액이 자동으로 재계산된다
- [ ] 존재하지 않는 장바구니 항목 제거 시 에러를 반환한다
- [ ] 장바구니의 마지막 상품을 제거하면 빈 장바구니가 된다

**Related Requirements:** FR-CART-003, FR-CART-005

---

## 3. 주문 처리

### US-ORDR-001: 주문 생성
**As a** 고객
**I want** 장바구니의 상품으로 주문을 생성하고 싶다
**So that** 상품을 구매할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니의 모든 상품을 포함하는 주문을 생성할 수 있다
- [ ] 주문 생성 시 각 상품의 재고를 확인한다
- [ ] 재고가 부족한 상품이 있으면 주문 생성이 실패한다
- [ ] 주문 생성 시 고유한 주문 ID가 발급된다
- [ ] 주문 생성 시점의 상품 가격이 저장된다
- [ ] 주문 초기 상태는 "대기"로 설정된다

**Related Requirements:** FR-ORDR-001, FR-ORDR-002, FR-ORDR-003, FR-INVT-001, FR-INVT-003

---

### US-ORDR-002: 주문 내역 조회
**As a** 고객
**I want** 내가 주문한 내역을 조회하고 싶다
**So that** 주문 상태와 상세 정보를 확인할 수 있다

**Acceptance Criteria:**
- [ ] 특정 사용자의 모든 주문 내역을 조회할 수 있다
- [ ] 각 주문의 주문 ID, 주문 일시, 상태, 총 금액을 확인할 수 있다
- [ ] 특정 주문의 상세 정보(상품 목록, 수량, 가격)를 조회할 수 있다
- [ ] 주문은 최신순으로 정렬된다
- [ ] 주문 상태(대기, 완료, 취소)가 명확하게 표시된다

**Related Requirements:** FR-ORDR-005, FR-ORDR-006

---

### US-ORDR-003: 동시 주문 시 재고 정합성 보장
**As a** 시스템
**I want** 동시에 여러 주문이 발생해도 재고를 정확하게 관리하고 싶다
**So that** 재고가 음수가 되거나 초과 판매되는 것을 방지할 수 있다

**Acceptance Criteria:**
- [ ] 동일 상품에 대한 동시 주문이 발생해도 재고가 정확하게 차감된다
- [ ] 재고가 10개이고 동시에 10개 주문이 들어오면, 재고 확인 시점 기준으로 처리된다
- [ ] 재고가 부족하면 후순위 주문은 실패한다
- [ ] 비관적 락 또는 낙관적 락을 통해 동시성을 제어한다
- [ ] 재고는 절대 음수가 되지 않는다

**Related Requirements:** FR-INVT-004, NFR-INTG-001

---

## 4. 결제 시스템

### US-PAY-001: 잔액 조회
**As a** 고객
**I want** 내 계정의 잔액을 조회하고 싶다
**So that** 결제 가능 여부를 확인할 수 있다

**Acceptance Criteria:**
- [ ] 사용자의 현재 잔액을 조회할 수 있다
- [ ] 잔액은 항상 0 이상이어야 한다
- [ ] 응답 시간은 빠르게 처리되어야 한다
- [ ] 사용자가 존재하지 않으면 에러를 반환한다

**Related Requirements:** FR-PAY-002, FR-PAY-001

---

### US-PAY-002: 잔액 충전
**As a** 고객
**I want** 내 계정에 잔액을 충전하고 싶다
**So that** 상품을 구매할 수 있다

**Acceptance Criteria:**
- [ ] 충전할 금액을 입력하여 잔액을 충전할 수 있다
- [ ] 충전 금액은 0보다 커야 한다
- [ ] 충전 후 즉시 잔액에 반영된다
- [ ] 충전 이력이 기록된다
- [ ] 동시에 여러 충전이 발생해도 잔액이 정확하게 증가한다

**Related Requirements:** FR-PAY-003, NFR-INTG-003

---

### US-PAY-003: 주문 결제 (쿠폰 미적용)
**As a** 고객
**I want** 생성한 주문을 잔액으로 결제하고 싶다
**So that** 상품을 구매 완료할 수 있다

**Acceptance Criteria:**
- [ ] 주문 금액과 사용자 잔액을 비교하여 결제 가능 여부를 확인한다
- [ ] 잔액이 충분한 경우 결제가 완료된다
- [ ] 결제 완료 시 주문 상태가 "완료"로 변경된다
- [ ] 결제 완료 시 주문한 상품의 재고가 차감된다
- [ ] 결제 완료 시 사용자 잔액이 차감된다
- [ ] 잔액이 부족한 경우 결제가 실패하고 에러 메시지를 반환한다
- [ ] 결제 실패 시 재고는 차감되지 않는다
- [ ] 결제-재고차감-잔액차감은 트랜잭션으로 처리된다 (원자성 보장)

**Related Requirements:** FR-PAY-004, FR-PAY-006, FR-PAY-007, FR-ORDR-004, NFR-INTG-004, NFR-INTG-005

---

### US-PAY-004: 주문 결제 (쿠폰 적용)
**As a** 고객
**I want** 쿠폰을 사용하여 할인된 금액으로 결제하고 싶다
**So that** 더 저렴하게 상품을 구매할 수 있다

**Acceptance Criteria:**
- [ ] 결제 시 보유한 쿠폰을 선택하여 적용할 수 있다
- [ ] 쿠폰의 유효성(유효기간, 사용 여부)이 검증된다
- [ ] 쿠폰 할인이 적용된 최종 금액이 계산된다
- [ ] 할인된 금액만큼 잔액에서 차감된다
- [ ] 쿠폰 사용 후 쿠폰 상태가 "사용됨"으로 변경된다
- [ ] 한 주문에는 하나의 쿠폰만 적용할 수 있다
- [ ] 유효하지 않은 쿠폰 사용 시 결제가 실패한다
- [ ] 할인 후 금액보다 잔액이 부족하면 결제가 실패한다

**Related Requirements:** FR-PAY-005, FR-COUP-006, FR-COUP-007, FR-COUP-008, FR-COUP-009, FR-COUP-010

---

## 5. 쿠폰 시스템

### US-COUP-001: 선착순 쿠폰 발급
**As a** 고객
**I want** 이벤트 쿠폰을 발급받고 싶다
**So that** 할인 혜택을 받을 수 있다

**Acceptance Criteria:**
- [ ] 쿠폰 발급 요청 시 남은 수량을 확인한다
- [ ] 쿠폰이 남아있으면 발급에 성공한다
- [ ] 발급 성공 시 쿠폰 잔여 수량이 1 감소한다
- [ ] 쿠폰이 소진되면 발급이 거부되고 에러 메시지를 반환한다
- [ ] 발급된 쿠폰에는 유효기간이 설정된다
- [ ] 동일한 사용자가 같은 쿠폰을 중복 발급받을 수 없다 (optional)

**Related Requirements:** FR-COUP-001, FR-COUP-002, FR-COUP-003

---

### US-COUP-002: 쿠폰 목록 조회
**As a** 고객
**I want** 내가 보유한 쿠폰 목록을 조회하고 싶다
**So that** 사용 가능한 쿠폰을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 사용자가 보유한 모든 쿠폰을 조회할 수 있다
- [ ] 각 쿠폰의 할인 금액/율, 유효기간, 사용 여부가 표시된다
- [ ] 사용 가능한 쿠폰과 사용된 쿠폰이 구분되어 표시된다
- [ ] 유효기간이 지난 쿠폰도 목록에 표시되지만 구분된다
- [ ] 쿠폰이 없는 경우 빈 목록을 반환한다

**Related Requirements:** FR-COUP-004

---

### US-COUP-003: 동시 쿠폰 발급 시 정합성 보장
**As a** 시스템
**I want** 동시에 여러 쿠폰 발급 요청이 발생해도 수량을 정확하게 관리하고 싶다
**So that** 발급 한도를 초과하여 쿠폰이 발급되는 것을 방지할 수 있다

**Acceptance Criteria:**
- [ ] 쿠폰이 100개 남았고 동시에 200개 발급 요청이 들어오면, 정확히 100개만 발급된다
- [ ] 나머지 100개 요청은 "쿠폰 소진" 에러를 반환한다
- [ ] 비관적 락 또는 낙관적 락을 통해 동시성을 제어한다
- [ ] 쿠폰 수량은 절대 음수가 되지 않는다
- [ ] 발급된 쿠폰 수와 실제 감소한 수량이 일치한다

**Related Requirements:** FR-COUP-005, NFR-INTG-002

---

## 6. 데이터 연동

### US-DATA-001: 주문 데이터 외부 전송
**As a** 시스템
**I want** 주문 완료 시 데이터를 외부 플랫폼으로 전송하고 싶다
**So that** 주문 데이터를 분석 및 모니터링할 수 있다

**Acceptance Criteria:**
- [ ] 주문이 완료되면 주문 데이터를 외부 데이터 플랫폼으로 전송한다
- [ ] 전송 데이터에는 주문 ID, 상품 정보, 금액, 사용자 정보, 주문 일시가 포함된다
- [ ] 전송은 비동기로 처리되어 주문 처리 성능에 영향을 주지 않는다
- [ ] 전송 성공 시 전송 이력이 기록된다
- [ ] 전송 실패 시에도 주문은 정상적으로 완료된다

**Related Requirements:** FR-DATA-001, FR-DATA-002, NFR-AVAIL-001

---

### US-DATA-002: 데이터 전송 실패 처리
**As a** 시스템
**I want** 외부 플랫폼 전송이 실패하면 이를 기록하고 재시도하고 싶다
**So that** 데이터 유실을 방지할 수 있다

**Acceptance Criteria:**
- [ ] 데이터 전송 실패 시 실패 이력이 기록된다
- [ ] 실패 이력에는 주문 ID, 실패 시각, 실패 사유가 포함된다
- [ ] 실패한 데이터는 별도 큐 또는 테이블에 저장된다
- [ ] 실패한 데이터를 재시도할 수 있는 API가 제공된다
- [ ] 재시도는 수동 또는 스케줄러를 통해 실행할 수 있다
- [ ] 재시도 성공 시 실패 이력이 해소된다

**Related Requirements:** FR-DATA-003, FR-DATA-004

---

## 부록: 우선순위별 스토리 매핑

### Phase 1 (높음) - 핵심 기능
1. US-PROD-001: 상품 목록 조회
2. US-PROD-002: 상품 상세 정보 조회
3. US-ORDR-001: 주문 생성
4. US-ORDR-003: 동시 주문 시 재고 정합성 보장
5. US-PAY-001: 잔액 조회
6. US-PAY-002: 잔액 충전
7. US-PAY-003: 주문 결제 (쿠폰 미적용)

### Phase 2 (중간) - 부가 기능
1. US-CART-001: 장바구니에 상품 추가
2. US-CART-002: 장바구니 조회
3. US-CART-003: 장바구니 상품 수량 변경
4. US-CART-004: 장바구니 상품 제거
5. US-COUP-001: 선착순 쿠폰 발급
6. US-COUP-002: 쿠폰 목록 조회
7. US-COUP-003: 동시 쿠폰 발급 시 정합성 보장
8. US-PAY-004: 주문 결제 (쿠폰 적용)
9. US-PROD-003: 인기 상품 조회

### Phase 3 (낮음) - 확장 기능
1. US-DATA-001: 주문 데이터 외부 전송
2. US-DATA-002: 데이터 전송 실패 처리
3. US-ORDR-002: 주문 내역 조회

---

## 스토리 포인트 추정 (참고)

| Story ID | 복잡도 | 예상 SP |
|----------|--------|---------|
| US-PROD-001 | 낮음 | 2 |
| US-PROD-002 | 낮음 | 2 |
| US-PROD-003 | 중간 | 5 |
| US-CART-001 | 낮음 | 3 |
| US-CART-002 | 낮음 | 2 |
| US-CART-003 | 낮음 | 2 |
| US-CART-004 | 낮음 | 1 |
| US-ORDR-001 | 높음 | 8 |
| US-ORDR-002 | 낮음 | 3 |
| US-ORDR-003 | 높음 | 8 |
| US-PAY-001 | 낮음 | 1 |
| US-PAY-002 | 중간 | 3 |
| US-PAY-003 | 높음 | 8 |
| US-PAY-004 | 높음 | 5 |
| US-COUP-001 | 중간 | 5 |
| US-COUP-002 | 낮음 | 2 |
| US-COUP-003 | 높음 | 8 |
| US-DATA-001 | 중간 | 5 |
| US-DATA-002 | 중간 | 5 |
